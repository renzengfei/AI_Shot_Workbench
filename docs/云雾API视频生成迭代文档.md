# äº‘é›¾ API è§†é¢‘ç”ŸæˆåŠŸèƒ½è¿­ä»£æ–‡æ¡£

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 ç°çŠ¶
- å·²å®Œæˆäº‘é›¾ API åç«¯é›†æˆï¼ˆ`yunwu_video_service.py`ï¼‰
- æ”¯æŒ Lovart è‡ªåŠ¨åŒ– / äº‘é›¾ API åŒæ¨¡å¼åˆ‡æ¢
- API è°ƒç”¨å·²éªŒè¯å¯ç”¨

### 1.2 è¿­ä»£ç›®æ ‡
- **å‰ç«¯é…ç½®ç•Œé¢**ï¼šå¯è§†åŒ–é…ç½® API Keyã€ç”Ÿæˆå‚æ•°
- **å¹¶å‘æ”¯æŒ**ï¼šæ‰¹é‡ä»»åŠ¡å¹¶è¡Œå¤„ç†ï¼Œæé«˜æ•ˆç‡
- **è¿›åº¦æ˜¾ç¤º**ï¼šå®æ—¶å±•ç¤ºç”Ÿæˆè¿›åº¦ã€çŠ¶æ€å˜åŒ–
- **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼šä¸€é”®ç”Ÿæˆã€ä»»åŠ¡ç®¡ç†ã€ç»“æœé¢„è§ˆ

---

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 å‰ç«¯é…ç½®ç•Œé¢

#### 2.1.1 è§†é¢‘ç”Ÿæˆæ¨¡å¼åˆ‡æ¢
```
ä½ç½®ï¼šStep7_VideoGen ç»„ä»¶é¡¶éƒ¨
```

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| æ¨¡å¼é€‰æ‹©å™¨ | Toggle åˆ‡æ¢ Lovart / API æ¨¡å¼ |
| çŠ¶æ€æŒ‡ç¤º | æ˜¾ç¤ºå½“å‰æ¨¡å¼ã€API è¿æ¥çŠ¶æ€ |
| å¿«æ·é…ç½®å…¥å£ | ç‚¹å‡»æ‰“å¼€é…ç½®é¢æ¿ |

**UI è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§†é¢‘ç”Ÿæˆ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  ğŸ¤– Lovart è‡ªåŠ¨åŒ–  â”‚  â”‚  â˜ï¸ äº‘é›¾ API     â”‚  â† æ¨¡å¼åˆ‡æ¢    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â— API å·²è¿æ¥  |  ä½™é¢: Â¥128.50  |  âš™ï¸ é…ç½®                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.1.2 API é…ç½®é¢æ¿ï¼ˆModalï¼‰

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| API Key | å¯†ç è¾“å…¥æ¡† | - | äº‘é›¾å¹³å° API Key |
| é»˜è®¤æ¨¡å‹ | ä¸‹æ‹‰é€‰æ‹© | `grok-video-3` | è§†é¢‘ç”Ÿæˆæ¨¡å‹ |
| é»˜è®¤å°ºå¯¸ | ä¸‹æ‹‰é€‰æ‹© | `1080P` | 720P / 1080P |
| é»˜è®¤æ¯”ä¾‹ | ä¸‹æ‹‰é€‰æ‹© | `9:16` | 9:16 / 16:9 / 1:1 |
| å¹¶å‘æ•° | æ»‘å— | 3 | 1-5 |
| è½®è¯¢é—´éš” | è¾“å…¥æ¡† | 10s | çŠ¶æ€æŸ¥è¯¢é—´éš” |

**UI è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜ï¸ äº‘é›¾ API é…ç½®                                    [Ã—]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  API Key                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [æµ‹è¯•è¿æ¥] â”‚
â”‚  â”‚ sk-****************************x4KR         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ æ¨¡å‹            â”‚  â”‚ å°ºå¯¸            â”‚                  â”‚
â”‚  â”‚ grok-video-3 â–¼  â”‚  â”‚ 1080P        â–¼  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ æ¯”ä¾‹            â”‚  â”‚ å¹¶å‘æ•°          â”‚                  â”‚
â”‚  â”‚ 9:16         â–¼  â”‚  â”‚ â—â—â—â—‹â—‹  3       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚                              [å–æ¶ˆ]  [ä¿å­˜é…ç½®]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 æ‰¹é‡ç”Ÿæˆä¸å¹¶å‘

#### 2.2.1 æ‰¹é‡ä»»åŠ¡æ·»åŠ 
- ä» Step6ï¼ˆå›¾ç‰‡ç”Ÿæˆï¼‰è‡ªåŠ¨è·å–å·²ç”Ÿæˆçš„å›¾ç‰‡
- æ”¯æŒå‹¾é€‰éœ€è¦ç”Ÿæˆè§†é¢‘çš„é•œå¤´
- ä¸€é”®æ·»åŠ æ‰€æœ‰å¾…ç”Ÿæˆä»»åŠ¡

#### 2.2.2 å¹¶å‘æ‰§è¡Œç­–ç•¥
```python
# å¹¶å‘æ§åˆ¶å‚æ•°
max_concurrent = 3       # æœ€å¤§å¹¶å‘æ•°
poll_interval = 10       # è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰
max_wait_per_task = 600  # å•ä»»åŠ¡è¶…æ—¶ï¼ˆç§’ï¼‰
retry_on_fail = True     # å¤±è´¥é‡è¯•
max_retries = 2          # æœ€å¤§é‡è¯•æ¬¡æ•°
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¹¶å‘ä»»åŠ¡è°ƒåº¦å™¨                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   ä»»åŠ¡é˜Ÿåˆ—                 æ‰§è¡Œæ±  (max=3)                   â”‚
â”‚   â”Œâ”€â”€â”€â”                   â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                â”‚
â”‚   â”‚ 5 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ 1 â”‚ â”‚ 2 â”‚ â”‚ 3 â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”¤                   â”‚ â³â”‚ â”‚ â³â”‚ â”‚ âœ“ â”‚                â”‚
â”‚   â”‚ 6 â”‚                   â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                â”‚
â”‚   â”œâ”€â”€â”€â”¤                         â”‚                          â”‚
â”‚   â”‚ 7 â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (å®Œæˆåè¡¥å……)              â”‚
â”‚   â””â”€â”€â”€â”˜                                                     â”‚
â”‚                                                             â”‚
â”‚   çŠ¶æ€: 3/7 æ‰§è¡Œä¸­  |  2/7 å·²å®Œæˆ  |  é¢„è®¡å‰©ä½™: 8åˆ†é’Ÿ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.3 è¿›åº¦æ˜¾ç¤º

#### 2.3.1 ä»»åŠ¡å¡ç‰‡çŠ¶æ€

æ¯ä¸ªé•œå¤´çš„è§†é¢‘ç”Ÿæˆå¡ç‰‡æ˜¾ç¤ºï¼š

| çŠ¶æ€ | å›¾æ ‡ | é¢œè‰² | è¯´æ˜ |
|------|------|------|------|
| pending | â¸ï¸ | ç°è‰² | ç­‰å¾…æ‰§è¡Œ |
| queued | ğŸ• | è“è‰² | å·²åŠ å…¥é˜Ÿåˆ— |
| processing | â³ | æ©™è‰² | ç”Ÿæˆä¸­ |
| completed | âœ… | ç»¿è‰² | å·²å®Œæˆ |
| failed | âŒ | çº¢è‰² | å¤±è´¥ |

**å•ä»»åŠ¡è¿›åº¦å¡ç‰‡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shot 1.0                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚             â”‚  â³ ç”Ÿæˆä¸­...           â”‚
â”‚  â”‚   [ç¼©ç•¥å›¾]   â”‚  è¿›åº¦: 75%            â”‚
â”‚  â”‚             â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 1:23       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  prompt: camera slowly zooms in...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 æ€»ä½“è¿›åº¦é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š æ‰¹é‡ç”Ÿæˆè¿›åº¦                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ€»è¿›åº¦: 5/12 å®Œæˆ                                          â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  42%                     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ âœ…  â”‚ â”‚ âœ…  â”‚ â”‚ âœ…  â”‚ â”‚ â³  â”‚ â”‚ â³  â”‚ â”‚ ğŸ•  â”‚ ...      â”‚
â”‚  â”‚ 1.0 â”‚ â”‚ 1.1 â”‚ â”‚ 2.0 â”‚ â”‚ 2.1 â”‚ â”‚ 3.0 â”‚ â”‚ 3.1 â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â”‚  å¹¶å‘: 3  |  é¢„è®¡å‰©ä½™: 12åˆ†é’Ÿ  |  [æš‚åœ] [åœæ­¢]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 å®æ—¶æ—¥å¿—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ æ‰§è¡Œæ—¥å¿—                                    [æ¸…ç©º] [å¯¼å‡º]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  13:15:23  [INFO]  ä»»åŠ¡ 1.0 å¼€å§‹æ‰§è¡Œ                        â”‚
â”‚  13:15:24  [INFO]  API è¿”å›ä»»åŠ¡ID: grok:ff3e2b29-...        â”‚
â”‚  13:15:34  [INFO]  ä»»åŠ¡ 1.0 è¿›åº¦: 25%                       â”‚
â”‚  13:15:44  [INFO]  ä»»åŠ¡ 1.0 è¿›åº¦: 55%                       â”‚
â”‚  13:15:54  [INFO]  ä»»åŠ¡ 1.0 è¿›åº¦: 90%                       â”‚
â”‚  13:16:04  [SUCCESS]  ä»»åŠ¡ 1.0 å®Œæˆï¼Œè§†é¢‘å·²ä¸‹è½½              â”‚
â”‚  13:16:05  [INFO]  ä»»åŠ¡ 1.1 å¼€å§‹æ‰§è¡Œ                        â”‚
â”‚  ...                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.4 ç»“æœé¢„è§ˆä¸ç®¡ç†

#### 2.4.1 è§†é¢‘é¢„è§ˆ
- å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºè§†é¢‘ç¼©ç•¥å›¾
- ç‚¹å‡»æ’­æ”¾é¢„è§ˆ
- æ”¯æŒä¸‹è½½åˆ°æœ¬åœ°

#### 2.4.2 ä»»åŠ¡ç®¡ç†
- é‡è¯•å¤±è´¥ä»»åŠ¡
- åˆ é™¤ä»»åŠ¡
- å¯¼å‡ºä»»åŠ¡åˆ—è¡¨

---

## 3. æŠ€æœ¯å®ç°

### 3.1 åç«¯ API æ‰©å±•

#### 3.1.1 æ–°å¢æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/yunwu/config` | GET/POST | è·å–/ä¿å­˜é…ç½® |
| `/api/yunwu/test-connection` | POST | æµ‹è¯• API è¿æ¥ |
| `/api/yunwu/tasks/run-concurrent` | POST | å¹¶å‘æ‰§è¡Œä»»åŠ¡ |
| `/api/yunwu/progress` | GET (SSE) | å®æ—¶è¿›åº¦æ¨é€ |

#### 3.1.2 å¹¶å‘æ‰§è¡Œå™¨

```python
# backend/services/yunwu_video_service.py

async def run_concurrent(
    self,
    task_ids: List[str],
    max_concurrent: int = 3,
    progress_callback: Callable = None
):
    """
    å¹¶å‘æ‰§è¡Œå¤šä¸ªè§†é¢‘ç”Ÿæˆä»»åŠ¡
    
    Args:
        task_ids: ä»»åŠ¡IDåˆ—è¡¨
        max_concurrent: æœ€å¤§å¹¶å‘æ•°
        progress_callback: è¿›åº¦å›è°ƒå‡½æ•°
    """
    semaphore = asyncio.Semaphore(max_concurrent)
    
    async def run_with_semaphore(task_id):
        async with semaphore:
            task = self.get_task(task_id)
            if task:
                await self.process_task(task, progress_callback)
    
    await asyncio.gather(*[
        run_with_semaphore(tid) for tid in task_ids
    ])
```

#### 3.1.3 SSE è¿›åº¦æ¨é€

```python
# backend/main.py

from sse_starlette.sse import EventSourceResponse

@app.get("/api/yunwu/progress")
async def yunwu_progress_stream(task_ids: str):
    """SSE å®æ—¶è¿›åº¦æ¨é€"""
    ids = task_ids.split(",")
    
    async def event_generator():
        while True:
            service = get_yunwu_video_service()
            progress_data = []
            all_done = True
            
            for tid in ids:
                task = service.get_task(tid)
                if task:
                    progress_data.append({
                        "task_id": tid,
                        "status": task.status,
                        "progress": task.api_response.get("progress", 0) if task.api_response else 0
                    })
                    if task.status in ["pending", "processing"]:
                        all_done = False
            
            yield {
                "event": "progress",
                "data": json.dumps(progress_data)
            }
            
            if all_done:
                yield {"event": "done", "data": "{}"}
                break
            
            await asyncio.sleep(3)
    
    return EventSourceResponse(event_generator())
```

### 3.2 å‰ç«¯å®ç°

#### 3.2.1 çŠ¶æ€ç®¡ç† (Zustand)

```typescript
// lib/stores/videoGenStore.ts

interface VideoGenState {
  mode: 'lovart' | 'api';
  config: YunwuConfig;
  tasks: VideoTask[];
  isRunning: boolean;
  progress: Record<string, number>;
  
  // Actions
  setMode: (mode: 'lovart' | 'api') => void;
  saveConfig: (config: YunwuConfig) => Promise<void>;
  addTasks: (shots: Shot[]) => Promise<void>;
  runConcurrent: (taskIds: string[]) => Promise<void>;
  stopAll: () => Promise<void>;
}

interface YunwuConfig {
  apiKey: string;
  model: string;
  size: string;
  aspectRatio: string;
  maxConcurrent: number;
  pollInterval: number;
}
```

#### 3.2.2 è¿›åº¦è®¢é˜… Hook

```typescript
// hooks/useVideoProgress.ts

export function useVideoProgress(taskIds: string[]) {
  const [progress, setProgress] = useState<Record<string, TaskProgress>>({});
  
  useEffect(() => {
    if (taskIds.length === 0) return;
    
    const eventSource = new EventSource(
      `/api/yunwu/progress?task_ids=${taskIds.join(',')}`
    );
    
    eventSource.addEventListener('progress', (e) => {
      const data = JSON.parse(e.data);
      setProgress(prev => {
        const next = { ...prev };
        data.forEach((item: TaskProgress) => {
          next[item.task_id] = item;
        });
        return next;
      });
    });
    
    eventSource.addEventListener('done', () => {
      eventSource.close();
    });
    
    return () => eventSource.close();
  }, [taskIds]);
  
  return progress;
}
```

#### 3.2.3 ç»„ä»¶ç»“æ„

```
Step7_VideoGen/
â”œâ”€â”€ VideoGenHeader.tsx        # æ¨¡å¼åˆ‡æ¢ã€é…ç½®å…¥å£
â”œâ”€â”€ ConfigModal.tsx           # API é…ç½®å¼¹çª—
â”œâ”€â”€ TaskGrid.tsx              # ä»»åŠ¡å¡ç‰‡ç½‘æ ¼
â”œâ”€â”€ TaskCard.tsx              # å•ä¸ªä»»åŠ¡å¡ç‰‡
â”œâ”€â”€ ProgressPanel.tsx         # æ€»ä½“è¿›åº¦é¢æ¿
â”œâ”€â”€ LogPanel.tsx              # æ‰§è¡Œæ—¥å¿—
â””â”€â”€ VideoPreview.tsx          # è§†é¢‘é¢„è§ˆ
```

---

## 4. æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ“ä½œ                               â”‚
â”‚  1. é…ç½® API  â†’  2. é€‰æ‹©é•œå¤´  â†’  3. å¼€å§‹ç”Ÿæˆ  â†’  4. æŸ¥çœ‹ç»“æœ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯ (React + Zustand)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ConfigModal â”‚  â”‚  TaskGrid   â”‚  â”‚ProgressPanelâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                â”‚                â”‚                  â”‚
â”‚         â–¼                â–¼                â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              videoGenStore (Zustand)             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åç«¯ (FastAPI)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚            /api/yunwu/* è·¯ç”±                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                               â”‚
â”‚                              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚          YunwuVideoService                       â”‚        â”‚
â”‚  â”‚  - ä»»åŠ¡ç®¡ç†  - å¹¶å‘æ‰§è¡Œ  - è¿›åº¦è¿½è¸ª              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº‘é›¾ API (yunwu.ai)                        â”‚
â”‚  POST /v1/video/create  â†â†’  GET /v1/video/query              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. å®ç°è®¡åˆ’

### Phase 1: åç«¯å¢å¼º (1å¤©)
- [ ] æ·»åŠ é…ç½®ç®¡ç† APIï¼ˆä¿å­˜/è¯»å– API Key å’Œé»˜è®¤å‚æ•°ï¼‰
- [ ] å®ç°å¹¶å‘ä»»åŠ¡æ‰§è¡Œå™¨
- [ ] æ·»åŠ  SSE è¿›åº¦æ¨é€ç«¯ç‚¹
- [ ] æ·»åŠ è¿æ¥æµ‹è¯• API

### Phase 2: å‰ç«¯åŸºç¡€ (1å¤©)
- [ ] åˆ›å»º `videoGenStore` çŠ¶æ€ç®¡ç†
- [ ] å®ç°æ¨¡å¼åˆ‡æ¢ UI
- [ ] å®ç° API é…ç½®å¼¹çª—
- [ ] é›†æˆé…ç½®ä¿å­˜

### Phase 3: ä»»åŠ¡ç®¡ç† (1å¤©)
- [ ] å®ç°ä»»åŠ¡å¡ç‰‡ç»„ä»¶
- [ ] ä» Step6 è·å–å›¾ç‰‡åˆ—è¡¨
- [ ] æ‰¹é‡æ·»åŠ ä»»åŠ¡
- [ ] ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º

### Phase 4: è¿›åº¦ä¸å¹¶å‘ (1å¤©)
- [ ] å®ç° SSE è¿›åº¦è®¢é˜…
- [ ] è¿›åº¦æ¡åŠ¨ç”»
- [ ] å¹¶å‘æ‰§è¡Œæ§åˆ¶
- [ ] æ‰§è¡Œæ—¥å¿—é¢æ¿

### Phase 5: ç»“æœé¢„è§ˆ (0.5å¤©)
- [ ] è§†é¢‘é¢„è§ˆç»„ä»¶
- [ ] ä¸‹è½½åŠŸèƒ½
- [ ] å¤±è´¥é‡è¯•

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ– (0.5å¤©)
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] æ€§èƒ½è°ƒä¼˜

---

## 6. API å‚è€ƒ

### 6.1 äº‘é›¾ API

**åˆ›å»ºè§†é¢‘ä»»åŠ¡**
```http
POST https://yunwu.ai/v1/video/create
Content-Type: application/json
Authorization: Bearer {API_KEY}

{
  "model": "grok-video-3",
  "prompt": "camera slowly zooms in",
  "aspect_ratio": "9:16",
  "size": "1080P",
  "images": ["data:image/png;base64,..."]
}
```

**æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€**
```http
GET https://yunwu.ai/v1/video/query?id={task_id}
Authorization: Bearer {API_KEY}
```

**å“åº”ç¤ºä¾‹**
```json
{
  "id": "grok:ff3e2b29-...",
  "status": "completed",
  "progress": 100,
  "video_url": "https://...",
  "thumbnail_url": "https://..."
}
```

### 6.2 è¿”å›å°ºå¯¸è¯´æ˜

| è¯·æ±‚ size | å®é™…è¾“å‡º | è¯´æ˜ |
|-----------|----------|------|
| 720P | ~480Ã—848 | ä½åˆ†è¾¨ç‡ |
| 1080P | ~832Ã—1504 | é«˜åˆ†è¾¨ç‡ï¼ˆæ¨èï¼‰ |

> æ³¨æ„ï¼šå®é™…å°ºå¯¸ä¼šæ ¹æ®è¾“å…¥å›¾ç‰‡æ¯”ä¾‹è‡ªåŠ¨è°ƒæ•´

---

## 7. é£é™©ä¸æ³¨æ„äº‹é¡¹

1. **API é™æµ**ï¼šäº‘é›¾ API å¯èƒ½æœ‰å¹¶å‘é™åˆ¶ï¼Œéœ€è¦æ§åˆ¶è¯·æ±‚é¢‘ç‡
2. **å¤§æ–‡ä»¶ä¸Šä¼ **ï¼šå›¾ç‰‡ base64 å¯èƒ½è¶…è¿‡ 10MBï¼Œæ³¨æ„è¶…æ—¶è®¾ç½®
3. **é•¿æ—¶é—´ä»»åŠ¡**ï¼šå•ä¸ªè§†é¢‘ç”Ÿæˆå¯èƒ½éœ€è¦ 1-2 åˆ†é’Ÿï¼Œéœ€è¦å‹å¥½çš„ç­‰å¾…æç¤º
4. **è´¹ç”¨ç›‘æ§**ï¼šå»ºè®®æ·»åŠ ä½™é¢æŸ¥è¯¢å’Œæ¶ˆè´¹æé†’åŠŸèƒ½
