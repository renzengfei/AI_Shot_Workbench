# ç½‘é¡µè‡ªåŠ¨åŒ–ç”Ÿè§†é¢‘è¿­ä»£æ–‡æ¡£

## ğŸ“Š å½“å‰è¿›åº¦ (2024-12-02 01:20 æ›´æ–°)

### âœ… Phase 1-4 å·²å®Œæˆ

| é˜¶æ®µ | æ¨¡å— | çŠ¶æ€ |
|------|------|------|
| **Phase 1** | è´¦å·ç®¡ç† | âœ… å®Œæˆ |
| | - è´¦å·æ±  `account_pool.py` | âœ… |
| | - é‚®ä»¶æ¥æ”¶ `email_receiver.py` | âœ… |
| | - æŒ‡çº¹ç®¡ç† `fingerprint_manager.py` | âœ… |
| | - æ‰¹é‡æ³¨å†Œ `batch_register.py` | âœ… |
| **Phase 2** | è§†é¢‘ç”Ÿæˆè‡ªåŠ¨åŒ– | âœ… å®Œæˆ |
| | - ç™»å½• | âœ… |
| | - å›¾ç‰‡ä¸Šä¼  (JS DataTransfer) | âœ… |
| | - æç¤ºè¯å‘é€ (clipboard paste) | âœ… |
| | - æ–°æ ‡ç­¾é¡µåˆ‡æ¢ | âœ… |
| | - è§†é¢‘ç­‰å¾… + ä¸‹è½½ | âœ… |
| **Phase 3** | åç«¯ API | âœ… å®Œæˆ |
| | - `/api/lovart/tasks` (CRUD) | âœ… |
| | - `/api/lovart/tasks/{id}/run` | âœ… |
| | - `/api/lovart/process` | âœ… |
| **Phase 4** | å‰ç«¯é›†æˆ | âœ… å®Œæˆ |
| | - ShotCard "ç”Ÿè§†é¢‘" æŒ‰é’® | âœ… |
| | - handleGenerateVideo å›è°ƒ | âœ… |
| | - ä»»åŠ¡çŠ¶æ€è½®è¯¢ | âœ… |
| | - è§†é¢‘ä¿å­˜åˆ° workspace | âœ… |
| | - **ç”Ÿè§†é¢‘æŒ‰é’®ç§»è‡³è§†é¢‘æè¿°è¡Œ** | âœ… |
| | - **è§†é¢‘æµå±•ç¤ºç”Ÿæˆè§†é¢‘** | âœ… |
| | - **å ä½çŠ¶æ€/ç”Ÿæˆä¸­çŠ¶æ€ UI** | âœ… |
| | - **æ ‡é¢˜æ ·å¼ä¼˜åŒ–** | âœ… |

### åç«¯ API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/lovart/stats` | GET | è´¦å·å’Œä»»åŠ¡ç»Ÿè®¡ |
| `/api/lovart/tasks` | GET | ä»»åŠ¡åˆ—è¡¨ |
| `/api/lovart/tasks` | POST | æ·»åŠ ä»»åŠ¡ |
| `/api/lovart/tasks/batch` | POST | æ‰¹é‡æ·»åŠ  |
| `/api/lovart/tasks/{id}` | GET | ä»»åŠ¡è¯¦æƒ… |
| `/api/lovart/tasks/{id}/run` | POST | æ‰§è¡Œä»»åŠ¡ |
| `/api/lovart/process` | POST | æ‰¹é‡å¤„ç† |

### å‰ç«¯åŠŸèƒ½

- **ShotCard** è§†é¢‘æè¿°è¡Œæ·»åŠ ç´«ç²‰æ¸å˜"ç”Ÿè§†é¢‘"æŒ‰é’®
- ç‚¹å‡»åè°ƒç”¨ APIï¼Œåå°æ‰§è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–
- è§†é¢‘ä¿å­˜åˆ° `workspace/assets/videos/shot_{id}/`
- ä»»åŠ¡çŠ¶æ€è½®è¯¢ï¼Œå®Œæˆå Toast æç¤º
- **è§†é¢‘æµæ ‡ç­¾é¡µ** å±•ç¤ºç”Ÿæˆçš„è§†é¢‘ï¼ˆä¸å†å±•ç¤ºåŸç‰‡ï¼‰
- æ— è§†é¢‘æ—¶æ˜¾ç¤ºå ä½ç¬¦ + ç”Ÿæˆä¸­åŠ¨ç”»çŠ¶æ€
- æ ‡é¢˜æ ·å¼ä¼˜åŒ–ï¼šé¦–å¸§æè¿°(è“è‰²)ã€è§†é¢‘æè¿°(ç´«è‰²)

---

## ğŸ“ å·²å®Œæˆæ¨¡å—æ˜ç»†

| æ¨¡å— | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| è´¦å·æ±  | `backend/automation/account_pool.py` | âœ… å®Œæˆ |
| é‚®ä»¶æ¥æ”¶å™¨ | `backend/automation/email_receiver.py` | âœ… å®Œæˆ |
| æŒ‡çº¹ç®¡ç†å™¨ | `backend/automation/fingerprint_manager.py` | âœ… å®Œæˆ |
| æ‰¹é‡æ³¨å†Œ | `backend/automation/batch_register.py` | âœ… å®Œæˆ |
| è§†é¢‘ç”Ÿæˆå™¨ | `backend/automation/video_generator.py` | âœ… å®Œæˆ |
| æ‰¹é‡è§†é¢‘ | `backend/automation/batch_video.py` | âœ… å®Œæˆ |
| Lovart Service | `backend/services/lovart_service.py` | âœ… å®Œæˆ |
| CLI å·¥å…· | `backend/automation/cli.py` | âœ… å®Œæˆ |

### æ‰¹é‡æ³¨å†ŒçŠ¶æ€

```bash
# åå°è¿è¡Œä¸­ (PID: 13664)
è¿›åº¦: [19/150] (æˆªè‡³ 21:50)
æˆåŠŸæ³¨å†Œ: 15 ä¸ª
æˆåŠŸç‡: ~79%
ä»Šæ—¥å¯ç”¨è§†é¢‘: 45+ ä¸ª (15è´¦å· Ã— 3è§†é¢‘/å¤©)

# æŸ¥çœ‹çŠ¶æ€
cd backend && source .venv/bin/activate
python -m automation.cli status

# æŸ¥çœ‹æ—¥å¿—
tail -f batch_register.log
```

### å›¾ç‰‡ä¸Šä¼ åˆ†æ

é€šè¿‡æˆªå›¾åˆ†æ Lovart Home é¡µé¢ç»“æ„ï¼š
1. **éœ€è¦å…ˆç‚¹å‡» "Video" æ ‡ç­¾**è¿›å…¥è§†é¢‘ç”Ÿæˆæ¨¡å¼
2. è¾“å…¥æ¡†å·¦ä¾§æœ‰**é™„ä»¶å›¾æ ‡**ï¼ˆå›å½¢é’ˆæŒ‰é’®ï¼‰
3. æ–°ä¼šå‘˜å¼¹çª—éœ€è¦ç‚¹å‡»"æ”¾å¼ƒå…è´¹ç§¯åˆ†"å…³é—­

**å·²å¢å¼º `upload_image()` æ–¹æ³•**ï¼š
- å¤šç§é€‰æ‹©å™¨å°è¯•ç‚¹å‡» Video æ ‡ç­¾
- é¡µé¢ç»“æ„è°ƒè¯•è¾“å‡º
- è‡ªåŠ¨ä¿å­˜æˆªå›¾å’Œ HTML åˆ° `/tmp/` ç”¨äºåˆ†æ

### å¾…è§£å†³é—®é¢˜

**Chrome çª—å£ç«‹å³å…³é—­é—®é¢˜**
- æ‰¹é‡æ³¨å†Œæ­£åœ¨è¿è¡Œæ—¶ï¼Œå•ç‹¬å¯åŠ¨ Chrome ä¼šå¤±è´¥ï¼ˆèµ„æºå†²çªï¼‰
- é”™è¯¯ï¼š`no such window: target window already closed`
- **è§£å†³æ–¹æ¡ˆ**ï¼šç­‰å¾…æ‰¹é‡æ³¨å†Œé—´éš™æˆ–å®Œæˆåå†æµ‹è¯•

### ä¸‹æ¬¡ç»§ç»­

1. ç­‰å¾…æ‰¹é‡æ³¨å†Œå®Œæˆæˆ–åœ¨é—´éš™æœŸæµ‹è¯•è§†é¢‘ç”Ÿæˆ
2. åˆ†æ `/tmp/lovart_page.html` é¡µé¢ç»“æ„ï¼ˆä¸Šä¼ å¤±è´¥æ—¶è‡ªåŠ¨ä¿å­˜ï¼‰
3. å¦‚æœ file input æ–¹å¼éƒ½ä¸è¡Œï¼Œè€ƒè™‘ï¼š
   - ä½¿ç”¨å‰ªè´´æ¿ç²˜è´´ä¸Šä¼  (pyperclip + Ctrl+V)
   - ä½¿ç”¨æ‹–æ‹½ API (ActionChains)
   - åˆ†æ Lovart çš„ç½‘ç»œè¯·æ±‚ï¼Œç›´æ¥è°ƒç”¨ä¸Šä¼  API

### æ–‡ä»¶ç»“æ„

```
backend/automation/
â”œâ”€â”€ __init__.py           # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ account_pool.py       # è´¦å·æ± ç®¡ç†ï¼Œæ•°æ®å­˜å‚¨åœ¨ accounts.json
â”œâ”€â”€ email_receiver.py     # IMAP é‚®ä»¶æ¥æ”¶ï¼ŒéªŒè¯ç æå–
â”œâ”€â”€ fingerprint_manager.py # æŒ‡çº¹ç”Ÿæˆ/å­˜å‚¨ï¼Œæ•°æ®åœ¨ fingerprints.json
â”œâ”€â”€ batch_register.py     # æ‰¹é‡æ³¨å†Œè„šæœ¬ï¼ˆåå°è¿è¡Œï¼‰
â”œâ”€â”€ video_generator.py    # è§†é¢‘ç”Ÿæˆä¸»é€»è¾‘ï¼ˆå¾…å®Œå–„ä¸Šä¼ ï¼‰
â”œâ”€â”€ cli.py                # CLI ç›‘æ§å·¥å…·
â”œâ”€â”€ batch_video.py        # æ‰¹é‡è§†é¢‘ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ browser_pool.py       # æµè§ˆå™¨æ± ï¼ˆå¹¶è¡Œç”¨ï¼‰
â””â”€â”€ parallel_register.py  # å¹¶è¡Œæ³¨å†Œï¼ˆå¤‡ç”¨ï¼‰

backend/
â”œâ”€â”€ accounts.json         # è´¦å·æ•°æ®ï¼ˆå« fingerprint_idï¼‰
â”œâ”€â”€ fingerprints.json     # æŒ‡çº¹æ•°æ®
â”œâ”€â”€ batch_register.log    # æ³¨å†Œæ—¥å¿—
â””â”€â”€ reference_gallery/    # æµ‹è¯•å›¾ç‰‡
```

### å¸¸ç”¨å‘½ä»¤

```bash
# è¿›å…¥ç¯å¢ƒ
cd backend && source .venv/bin/activate

# æŸ¥çœ‹çŠ¶æ€
python -m automation.cli status

# æŸ¥çœ‹è´¦å·åˆ—è¡¨
python -m automation.cli accounts -l

# æŸ¥çœ‹æŒ‡çº¹åˆ—è¡¨
python -m automation.cli fingerprints

# å¯¼å‡ºè´¦å·ä¸º CSV
python -m automation.cli export -o accounts_export.csv

# å¯åŠ¨æ‰¹é‡æ³¨å†Œï¼ˆåå°ï¼‰
nohup python -u -m automation.batch_register -n 150 > batch_register.log 2>&1 &

# æµ‹è¯•å•ä¸ªè´¦å·ç™»å½•
python -c "
from automation import AccountPool, VideoGenerator
pool = AccountPool()
gen = VideoGenerator(pool)
acc = pool.get_account_by_email('xxx@aigoogle.top')
gen.launch_browser(acc)
gen.login(acc)
"
```

### å…³é”®å‘ç°

1. **æŒ‡çº¹æµè§ˆå™¨ä¿å­˜ Session**ï¼šä½¿ç”¨ `user-data-dir` åï¼Œç™»å½•çŠ¶æ€ä¼šä¿ç•™ï¼Œä¸‹æ¬¡è‡ªåŠ¨æ£€æµ‹è·³è¿‡ç™»å½•æµç¨‹
2. **Cloudflare æ£€æµ‹**ï¼šé¡µé¢åŒ…å«"æˆåŠŸ"æˆ–"éªŒè¯æˆåŠŸ"æ–‡å­—è¡¨ç¤ºé€šè¿‡
3. **æ–°ä¼šå‘˜å¼¹çª—**ï¼šç™»å½•åä¼šå¼¹å‡º"æ–°ä¼šå‘˜ç‰¹æƒ "ï¼Œéœ€è¦ç‚¹å‡»"æ”¾å¼ƒå…è´¹ç§¯åˆ†"å…³é—­
4. **éªŒè¯ç è¿‡æ»¤**ï¼šä½¿ç”¨ `request_timestamp` è¿‡æ»¤æ—§é‚®ä»¶ï¼Œé¿å…è·å–è¿‡æœŸéªŒè¯ç 

---

## å®ç°è®¡åˆ’

### Phase 1ï¼šåŸºç¡€è®¾æ–½ï¼ˆé¢„è®¡ 2 å¤©ï¼‰

- [ ] **1.1 é‚®ç®±ç³»ç»Ÿæ­å»º** ğŸ‘‡ [è¯¦ç»†æ•™ç¨‹](#11-é‚®ç®±ç³»ç»Ÿæ­å»ºæ•™ç¨‹)
  - è´­ä¹°åŸŸåï¼Œé…ç½® Cloudflare Email Routing Catch-All
  - è®¾ç½® Gmail IMAP è½¬å‘
  - æµ‹è¯•éªŒè¯ç æ¥æ”¶

- [ ] **1.2 è´¦å·æ± åˆå§‹åŒ–**
  - åˆ›å»º `backend/automation/account_pool.py`
  - å®ç° `generate_accounts()` ç”Ÿæˆ 50-100 ä¸ªè´¦å·é…ç½®
  - å®ç° `AccountPool` ç±»ï¼ˆåŠ è½½/ä¿å­˜/è·å–å¯ç”¨è´¦å·/æ ‡è®°ä½¿ç”¨ï¼‰

- [ ] **1.3 é‚®ä»¶æ¥æ”¶å™¨**
  - åˆ›å»º `backend/automation/email_receiver.py`
  - å®ç° IMAP è¿æ¥å’ŒéªŒè¯ç æå–
  - æµ‹è¯• Lovart.ai éªŒè¯ç é‚®ä»¶æ ¼å¼

### Phase 2ï¼šè‡ªåŠ¨åŒ–æ ¸å¿ƒï¼ˆé¢„è®¡ 3 å¤©ï¼‰

- [ ] **2.1 æŒ‡çº¹æµè§ˆå™¨**
  - åˆ›å»º `backend/automation/fingerprint_browser.py`
  - å®ç° `AsyncFingerprintBrowser` ç±»
  - æµ‹è¯•æŒ‡çº¹æ³¨å…¥æ•ˆæœ

- [ ] **2.2 Lovart.ai è‡ªåŠ¨åŒ–**
  - åˆ›å»º `backend/automation/lovart_automation.py`
  - å®ç° `login_or_register()` ç™»å½•/æ³¨å†Œæµç¨‹
  - å®ç° `generate_video_single()` å•æ¬¡è§†é¢‘ç”Ÿæˆ
  - å®ç° `generate_videos_for_shot()` å¹¶è¡Œç”Ÿæˆ

- [ ] **2.3 æ‰¹é‡æ³¨å†Œå·¥å…·**
  - åˆ›å»º `backend/automation/batch_register.py`
  - å®ç°å¹¶å‘æ³¨å†Œé€»è¾‘
  - æ‰‹åŠ¨è¿è¡Œå®Œæˆé¦–æ‰¹è´¦å·æ³¨å†Œ

### Phase 3ï¼šåç«¯ APIï¼ˆé¢„è®¡ 2 å¤©ï¼‰

- [ ] **3.1 è§†é¢‘ä»»åŠ¡ API**
  - åœ¨ `backend/main.py` æ·»åŠ  `POST /api/video-tasks`
  - åœ¨ `backend/main.py` æ·»åŠ  `GET /api/video-tasks/{taskId}`
  - å®ç°ä»»åŠ¡è®°å½•å­˜å‚¨ï¼ˆ`video_tasks/` ç›®å½•ï¼‰

- [ ] **3.2 åå°ä»»åŠ¡æ‰§è¡Œ**
  - å‚è€ƒ `run_image_task()` å®ç° `run_video_task()`
  - é›†æˆè°ƒåº¦å™¨ `VideoGenerationScheduler`
  - å®ç°è§†é¢‘ä¸‹è½½ä¿å­˜åˆ° `videos/` ç›®å½•

- [ ] **3.3 é…ç½®ç®¡ç†**
  - åˆ›å»º `backend/automation/config.py` è¯»å–é…ç½®
  - ç¯å¢ƒå˜é‡æˆ– `.env` ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ˆIMAP å¯†ç ç­‰ï¼‰

### Phase 4ï¼šå‰ç«¯é›†æˆï¼ˆé¢„è®¡ 2 å¤©ï¼‰

- [ ] **4.1 é•œå¤´å¡ç‰‡æ”¹é€ **
  - åœ¨ `ShotCard.tsx` æ·»åŠ "ç”Ÿè§†é¢‘"æŒ‰é’®
  - è°ƒç”¨ `POST /api/video-tasks` æäº¤ä»»åŠ¡
  - æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€ï¼ˆç”Ÿæˆä¸­/å®Œæˆ/å¤±è´¥ï¼‰

- [ ] **4.2 è§†é¢‘ç´ ææµ**
  - åœ¨ `Step3_DeconstructionReview.tsx` æ·»åŠ è§†é¢‘åˆ—è¡¨
  - ä» `generated_xxx/videos/` åŠ è½½è§†é¢‘
  - å®ç°è§†é¢‘é¢„è§ˆæ’­æ”¾

- [ ] **4.3 é…ç½®å¼¹çª—**
  - ä¿®æ”¹ä¾›åº”å•†æŒ‰é’®ä¸º"ç”Ÿå›¾ä¾›åº”å•†"
  - æ–°å¢"ç”Ÿè§†é¢‘é…ç½®"å¼¹çª—ï¼ˆheadless/ä»»åŠ¡æ•°/è¶…æ—¶ï¼‰

### Phase 5ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆé¢„è®¡ 1 å¤©ï¼‰

- [ ] **5.1 ç«¯åˆ°ç«¯æµ‹è¯•**
  - å•é•œå¤´ç”Ÿè§†é¢‘å®Œæ•´æµç¨‹
  - å¤šé•œå¤´å¹¶è¡Œç”Ÿæˆ
  - è´¦å·åˆ‡æ¢é€»è¾‘

- [ ] **5.2 é”™è¯¯å¤„ç†**
  - ç™»å½•å¤±æ•ˆæ£€æµ‹ä¸æç¤º
  - ä»»åŠ¡è¶…æ—¶å¤„ç†
  - å¤±è´¥é‡è¯•æœºåˆ¶

---

## 1.1 é‚®ç®±ç³»ç»Ÿæ­å»ºæ•™ç¨‹

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é‚®ä»¶æ¥æ”¶æµç¨‹                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Lovart.ai â”€â”€å‘é€éªŒè¯ç â”€â”€> user001@yourdomain.com               â”‚
â”‚                                  â”‚                              â”‚
â”‚                                  â–¼                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚   Cloudflare Catch-All  â”‚                  â”‚
â”‚                    â”‚   (æ‰€æœ‰ *@yourdomain    â”‚                  â”‚
â”‚                    â”‚    éƒ½è½¬å‘åˆ° Gmail)      â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                â”‚                                â”‚
â”‚                                â–¼                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚      Gmail æ”¶ä»¶ç®±        â”‚                  â”‚
â”‚                    â”‚   (å¯ç”¨ IMAP è®¿é—®)      â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                â”‚                                â”‚
â”‚                                â–¼                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚    Python IMAP è„šæœ¬     â”‚                  â”‚
â”‚                    â”‚   (æå– 6 ä½éªŒè¯ç )      â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1ï¼šè´­ä¹°åŸŸå

**æ¨èåŸŸåæ³¨å†Œå•†**ï¼š
- [Namecheap](https://www.namecheap.com) - ä¾¿å®œï¼Œçº¦ $8-10/å¹´
- [Cloudflare Registrar](https://www.cloudflare.com/products/registrar/) - æˆæœ¬ä»·ï¼Œçº¦ $9/å¹´
- [é˜¿é‡Œäº‘](https://wanwang.aliyun.com) - å›½å†…å‹å¥½ï¼Œçº¦ Â¥50-70/å¹´

**åŸŸåé€‰æ‹©å»ºè®®**ï¼š
- é€‰æ‹© `.com` æˆ– `.net`ï¼Œå¯ä¿¡åº¦é«˜
- é¿å…å¤ªçŸ­æˆ–å¤ªæœ‰æ„ä¹‰çš„åŸŸåï¼ˆè´µï¼‰
- ç¤ºä¾‹ï¼š`videobot2024.com`ã€`aitools-mail.com`

**è´­ä¹°åè·å¾—**ï¼š
- åŸŸåï¼š`yourdomain.com`
- DNS ç®¡ç†æƒé™

---

### Step 2ï¼šå°†åŸŸåæ¥å…¥ Cloudflare

1. **æ³¨å†Œ Cloudflare è´¦å·**ï¼šhttps://dash.cloudflare.com/sign-up

2. **æ·»åŠ åŸŸå**ï¼š
   - ç™»å½• Cloudflare â†’ "Add a site" â†’ è¾“å…¥ä½ çš„åŸŸå
   - é€‰æ‹© **Free è®¡åˆ’**

3. **ä¿®æ”¹ DNS æœåŠ¡å™¨**ï¼š
   - Cloudflare ä¼šç»™ä½ ä¸¤ä¸ª NS è®°å½•ï¼Œä¾‹å¦‚ï¼š
     ```
     ns1.cloudflare.com
     ns2.cloudflare.com
     ```
   - å›åˆ°åŸŸåæ³¨å†Œå•†ï¼Œå°† DNS æœåŠ¡å™¨æ”¹ä¸ºè¿™ä¸¤ä¸ª
   - ç­‰å¾…ç”Ÿæ•ˆï¼ˆé€šå¸¸ 10 åˆ†é’Ÿ ~ 24 å°æ—¶ï¼‰

4. **éªŒè¯æ¥å…¥**ï¼š
   - Cloudflare ä»ªè¡¨ç›˜æ˜¾ç¤º "Active" å³æˆåŠŸ

---

### Step 3ï¼šé…ç½® Cloudflare Email Routing

1. **è¿›å…¥ Email Routing**ï¼š
   - Cloudflare ä»ªè¡¨ç›˜ â†’ é€‰æ‹©ä½ çš„åŸŸå â†’ å·¦ä¾§èœå• "Email" â†’ "Email Routing"

2. **å¯ç”¨ Email Routing**ï¼š
   - ç‚¹å‡» "Get started" æˆ– "Enable Email Routing"
   - Cloudflare ä¼šè‡ªåŠ¨æ·»åŠ æ‰€éœ€çš„ MX å’Œ TXT è®°å½•

3. **æ·»åŠ ç›®æ ‡é‚®ç®±ï¼ˆDestination addressï¼‰**ï¼š
   - ç‚¹å‡» "Destination addresses" â†’ "Add destination address"
   - è¾“å…¥ä½ çš„é‚®ç®±åœ°å€ï¼ˆGmail / 163 / QQ / Outlook å‡å¯ï¼‰
   - å»æ”¶ä»¶ç®±ï¼Œç‚¹å‡»éªŒè¯é‚®ä»¶ä¸­çš„é“¾æ¥
   
   > **æ”¯æŒçš„é‚®ç®±æœåŠ¡**ï¼šGmailã€163ã€QQã€Outlookã€iCloud ç­‰ä»»ä½•æ”¯æŒ IMAP çš„é‚®ç®±éƒ½å¯ä»¥

4. **é…ç½® Catch-All è§„åˆ™** â­ï¸ å…³é”®æ­¥éª¤ï¼š
   - ç‚¹å‡» "Routing rules" â†’ "Catch-all address"
   - é€‰æ‹© "Send to an email" â†’ é€‰æ‹©ä½ åˆšæ·»åŠ çš„ Gmail
   - ç‚¹å‡» "Save"

5. **éªŒè¯ DNS è®°å½•**ï¼š
   - ä½ç½®ï¼šCloudflare ä»ªè¡¨ç›˜ â†’ é€‰æ‹©ä½ çš„åŸŸå â†’ å·¦ä¾§èœå• **"DNS"** â†’ **"Records"**
   - å¯ç”¨ Email Routing åï¼ŒCloudflare ä¼šè‡ªåŠ¨æ·»åŠ ä»¥ä¸‹è®°å½•ï¼š
   
   | ç±»å‹ | åç§° | å†…å®¹ |
   |------|------|------|
   | MX | @ | `route1.mx.cloudflare.net` (ä¼˜å…ˆçº§ 45) |
   | MX | @ | `route2.mx.cloudflare.net` (ä¼˜å…ˆçº§ 3) |
   | MX | @ | `route3.mx.cloudflare.net` (ä¼˜å…ˆçº§ 93) |
   | TXT | @ | `v=spf1 include:_spf.mx.cloudflare.net ~all` |
   
   > ğŸ’¡ å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ·»åŠ ï¼Œå›åˆ° Email â†’ Email Routing é¡µé¢ï¼Œç‚¹å‡» "Add records" æŒ‰é’®è®© Cloudflare è‡ªåŠ¨é…ç½®

---

### Step 4ï¼šé…ç½® Gmail IMAP è®¿é—®

1. **å¯ç”¨ IMAP**ï¼š
   - æ‰“å¼€ Gmail â†’ è®¾ç½®ï¼ˆé½¿è½®å›¾æ ‡ï¼‰â†’ "æŸ¥çœ‹æ‰€æœ‰è®¾ç½®"
   - åˆ‡æ¢åˆ° "è½¬å‘å’Œ POP/IMAP" æ ‡ç­¾
   - æ‰¾åˆ° "IMAP è®¿é—®" â†’ é€‰æ‹© **å¯ç”¨ IMAP**
   - ç‚¹å‡» "ä¿å­˜æ›´æ”¹"

2. **ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç ** â­ï¸ å¿…é¡»æ­¥éª¤ï¼š
   - å‰å¾€ï¼šhttps://myaccount.google.com/apppasswords
   - å¦‚æœæ²¡æœ‰å¼€å¯ä¸¤æ­¥éªŒè¯ï¼Œéœ€è¦å…ˆå¼€å¯ï¼šhttps://myaccount.google.com/signinoptions/two-step-verification
   - åœ¨åº”ç”¨ä¸“ç”¨å¯†ç é¡µé¢ï¼š
     - é€‰æ‹©åº”ç”¨ï¼š"é‚®ä»¶"
     - é€‰æ‹©è®¾å¤‡ï¼š"å…¶ä»–ï¼ˆè‡ªå®šä¹‰åç§°ï¼‰"
     - è¾“å…¥åç§°ï¼š`VideoBot IMAP`
     - ç‚¹å‡» "ç”Ÿæˆ"
   - **å¤åˆ¶å¹¶ä¿å­˜ç”Ÿæˆçš„ 16 ä½å¯†ç **ï¼ˆå½¢å¦‚ `xxxx xxxx xxxx xxxx`ï¼‰
   - âš ï¸ è¿™ä¸ªå¯†ç åªæ˜¾ç¤ºä¸€æ¬¡ï¼

3. **IMAP æœåŠ¡å™¨ä¿¡æ¯**ï¼š

   **Gmail**ï¼š
   | è®¾ç½®é¡¹ | å€¼ |
   |--------|-----|
   | IMAP æœåŠ¡å™¨ | `imap.gmail.com` |
   | ç«¯å£ | `993` |
   | ç”¨æˆ·å | `your-gmail@gmail.com` |
   | å¯†ç  | åº”ç”¨ä¸“ç”¨å¯†ç ï¼ˆ16ä½ï¼‰ |

   **163 é‚®ç®±**ï¼š
   | è®¾ç½®é¡¹ | å€¼ |
   |--------|-----|
   | IMAP æœåŠ¡å™¨ | `imap.163.com` |
   | ç«¯å£ | `993` |
   | ç”¨æˆ·å | `your-email@163.com` |
   | å¯†ç  | æˆæƒç ï¼ˆéç™»å½•å¯†ç ï¼‰âš ï¸ |

   > **163 é‚®ç®±è·å–æˆæƒç **ï¼š
   > 1. ç™»å½• 163 é‚®ç®±ç½‘é¡µç‰ˆ â†’ è®¾ç½® â†’ POP3/SMTP/IMAP
   > 2. å¼€å¯ IMAP æœåŠ¡
   > 3. æŒ‰æç¤ºå‘é€çŸ­ä¿¡è·å–**æˆæƒç **
   > 4. æˆæƒç å°±æ˜¯ IMAP ç™»å½•å¯†ç 
SXhTnPD5a2WfKjNa


   **QQ é‚®ç®±**ï¼š
   | è®¾ç½®é¡¹ | å€¼ |
   |--------|-----|
   | IMAP æœåŠ¡å™¨ | `imap.qq.com` |
   | ç«¯å£ | `993` |
   | ç”¨æˆ·å | `123456789@qq.com` |
   | å¯†ç  | æˆæƒç ï¼ˆåœ¨è®¾ç½®â†’è´¦æˆ·ä¸­ç”Ÿæˆï¼‰ |

   **Outlook/Hotmail**ï¼š
   | è®¾ç½®é¡¹ | å€¼ |
   |--------|-----|
   | IMAP æœåŠ¡å™¨ | `outlook.office365.com` |
   | ç«¯å£ | `993` |
   | ç”¨æˆ·å | `your-email@outlook.com` |
   | å¯†ç  | è´¦æˆ·å¯†ç æˆ–åº”ç”¨å¯†ç  |

---

### Step 5ï¼šæµ‹è¯•é‚®ä»¶æ¥æ”¶

1. **å‘é€æµ‹è¯•é‚®ä»¶**ï¼š
   - ç”¨ä»»æ„é‚®ç®±å‘é€é‚®ä»¶åˆ° `test123@yourdomain.com`
   - ç­‰å¾… 1-2 åˆ†é’Ÿ

2. **æ£€æŸ¥ Gmail æ”¶ä»¶ç®±**ï¼š
   - åº”è¯¥èƒ½æ”¶åˆ°é‚®ä»¶
   - é‚®ä»¶çš„ To åœ°å€åº”è¯¥æ˜¯ `test123@yourdomain.com`

3. **Python æµ‹è¯•è„šæœ¬**ï¼š

```python
# test_imap.py
import imaplib
import email
from email.header import decode_header

# é…ç½® - è¯·æ›¿æ¢ä¸ºä½ çš„ä¿¡æ¯
IMAP_SERVER = "imap.163.com"
USERNAME = "rzengfei@163.com"
APP_PASSWORD = "NMivvWY2ZNZk9CTd"  # åº”ç”¨ä¸“ç”¨å¯†ç 

def test_connection():
    print("è¿æ¥åˆ° IMAP æœåŠ¡å™¨...")
    mail = imaplib.IMAP4_SSL(IMAP_SERVER)
    
    print("ç™»å½•ä¸­...")
    mail.login(USERNAME, APP_PASSWORD)
    print("âœ“ ç™»å½•æˆåŠŸï¼")
    
    mail.select("inbox")
    
    # æœç´¢æœ€è¿‘çš„é‚®ä»¶
    status, messages = mail.search(None, "ALL")
    msg_ids = messages[0].split()
    print(f"æ”¶ä»¶ç®±å…±æœ‰ {len(msg_ids)} å°é‚®ä»¶")
    
    # è¯»å–æœ€æ–°ä¸€å°
    if msg_ids:
        latest_id = msg_ids[-1]
        status, msg_data = mail.fetch(latest_id, "(RFC822)")
        raw_email = msg_data[0][1]
        msg = email.message_from_bytes(raw_email)
        
        subject = decode_header(msg["Subject"])[0][0]
        if isinstance(subject, bytes):
            subject = subject.decode()
        to_addr = msg["To"]
        from_addr = msg["From"]
        
        print(f"\næœ€æ–°é‚®ä»¶:")
        print(f"  From: {from_addr}")
        print(f"  To: {to_addr}")
        print(f"  Subject: {subject}")
    
    mail.logout()
    print("\nâœ“ IMAP æµ‹è¯•å®Œæˆï¼")

if __name__ == "__main__":
    test_connection()
```

è¿è¡Œæµ‹è¯•ï¼š

```bash
python test_imap.py
```

é¢„æœŸè¾“å‡ºï¼š

```
è¿æ¥åˆ° IMAP æœåŠ¡å™¨...
ç™»å½•ä¸­...
âœ“ ç™»å½•æˆåŠŸï¼
æ”¶ä»¶ç®±å…±æœ‰ 42 å°é‚®ä»¶

æœ€æ–°é‚®ä»¶:
  From: someone@example.com
  To: test123@yourdomain.com
  Subject: Test Email

âœ“ IMAP æµ‹è¯•å®Œæˆï¼
```

---

### Step 6ï¼šæµ‹è¯• Lovart.ai éªŒè¯ç 

1. **æ‰‹åŠ¨æ³¨å†Œä¸€æ¬¡**ï¼š
   - æ‰“å¼€ https://www.lovart.ai/zh
   - ç‚¹å‡»æ³¨å†Œï¼Œè¾“å…¥ `test@yourdomain.com`
   - ç­‰å¾…éªŒè¯ç é‚®ä»¶

2. **æ£€æŸ¥éªŒè¯ç é‚®ä»¶æ ¼å¼**ï¼š
   - æŸ¥çœ‹é‚®ä»¶å‘ä»¶äººï¼ˆç”¨äºè¿‡æ»¤ï¼‰
   - æŸ¥çœ‹éªŒè¯ç åœ¨é‚®ä»¶ä¸­çš„ä½ç½®
   - é€šå¸¸æ˜¯ 6 ä½æ•°å­—

3. **æ›´æ–°éªŒè¯ç æå–è„šæœ¬**ï¼š

```python
# æ ¹æ®å®é™…é‚®ä»¶æ ¼å¼è°ƒæ•´æ­£åˆ™è¡¨è¾¾å¼
import re

def extract_verification_code(email_body: str) -> str | None:
    """ä»é‚®ä»¶æ­£æ–‡æå– 6 ä½éªŒè¯ç """
    # å¸¸è§æ ¼å¼ï¼šéªŒè¯ç ä¸º 123456 æˆ– Your code is 123456
    patterns = [
        r'éªŒè¯ç [ï¼š:]\s*(\d{6})',
        r'code[ï¼š:]\s*(\d{6})',
        r'\b(\d{6})\b',  # å…œåº•ï¼šåŒ¹é…ä»»æ„ 6 ä½æ•°å­—
    ]
    
    for pattern in patterns:
        match = re.search(pattern, email_body, re.IGNORECASE)
        if match:
            return match.group(1)
    
    return None
```

---

### å¸¸è§é—®é¢˜

**Q: Cloudflare æ˜¾ç¤º DNS è®°å½•æœ‰å†²çªæ€ä¹ˆåŠï¼Ÿ**

A: åˆ é™¤åŸæœ‰çš„ MX è®°å½•ï¼Œåªä¿ç•™ Cloudflare è‡ªåŠ¨æ·»åŠ çš„ã€‚

**Q: é‚®ä»¶æ”¶ä¸åˆ°ï¼Ÿ**

A: æ£€æŸ¥ï¼š
1. Cloudflare Email Routing æ˜¯å¦æ˜¾ç¤º "Active"
2. Catch-all è§„åˆ™æ˜¯å¦æ­£ç¡®é…ç½®
3. Gmail æ˜¯å¦å·²éªŒè¯ä¸ºç›®æ ‡åœ°å€
4. æ£€æŸ¥ Gmail åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹

**Q: IMAP ç™»å½•å¤±è´¥ï¼Ÿ**

A: ç¡®ä¿ï¼š
1. ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç ï¼Œä¸æ˜¯ Gmail å¯†ç 
2. å·²å¯ç”¨ä¸¤æ­¥éªŒè¯
3. IMAP å·²åœ¨ Gmail è®¾ç½®ä¸­å¯ç”¨

**Q: åº”ç”¨ä¸“ç”¨å¯†ç åœ¨å“ªé‡Œç”Ÿæˆï¼Ÿ**

A: https://myaccount.google.com/apppasswords ï¼ˆéœ€è¦å…ˆå¼€å¯ä¸¤æ­¥éªŒè¯ï¼‰

---

### é…ç½®æ¸…å•

å®Œæˆåä½ åº”è¯¥æ‹¥æœ‰ï¼š

- [ ] ä¸€ä¸ªåŸŸåï¼ˆå¦‚ `yourdomain.com`ï¼‰aigoogle.top
- [ ] Cloudflare è´¦å·ï¼ŒåŸŸåå·²æ¥å…¥
303364682@qq.com rzf303364.
- [ ] Email Routing å·²å¯ç”¨ï¼ŒCatch-all è§„åˆ™å·²é…ç½®
- [ ] Gmail å·²éªŒè¯ä¸ºç›®æ ‡åœ°å€
- [ ] Gmail IMAP å·²å¯ç”¨
- [ ] åº”ç”¨ä¸“ç”¨å¯†ç å·²ç”Ÿæˆå¹¶ä¿å­˜
- [ ] æµ‹è¯•é‚®ä»¶èƒ½æ­£å¸¸æ¥æ”¶
- [ ] Python IMAP è„šæœ¬æµ‹è¯•é€šè¿‡

---

## ç›®æ ‡åœºæ™¯
- åœ¨äººå·¥æ”¹å†™ç•Œé¢ï¼ˆé•œå¤´å¡ç‰‡ï¼‰çš„è§†é¢‘æè¿°å³ä¾§æ–°å¢"ç”Ÿè§†é¢‘"æŒ‰é’®ã€‚
- ç‚¹å‡»åè‡ªåŠ¨é©±åŠ¨ Chromeï¼ˆå¯åå°/å¯è§ï¼Œå¯é…ç½®ï¼‰è®¿é—®è§†é¢‘ç”Ÿæˆå¹³å°ï¼Œå®Œæˆå›¾ç”Ÿè§†é¢‘ä»»åŠ¡ã€‚
- **ä¸»è¦æ–¹æ¡ˆ**ï¼šLovart.ai + æ‰¹é‡è´¦å·ç³»ç»Ÿ
- **å¤‡é€‰æ–¹æ¡ˆ**ï¼šæµ·èº AIï¼ˆæš‚ä¸å®ç°ï¼Œè§æ–‡æ¡£æœ«å°¾é™„å½•ï¼‰

---

# æ–¹æ¡ˆä¸€ï¼šLovart.ai + æ‰¹é‡è´¦å·ç³»ç»Ÿï¼ˆä¸»è¦æ–¹æ¡ˆï¼‰

## å¹³å°è¯´æ˜
- **ç›®æ ‡ç½‘å€**ï¼š`https://www.lovart.ai/canvas?projectId={id}&agent=1`
- **é™åˆ¶**ï¼šæ¯ä¸ªè´¦å·æ¯å¤©ä»…èƒ½ç”Ÿæˆ 3 ä¸ªè§†é¢‘
- **æ³¨å†Œæ–¹å¼**ï¼šé‚®ç®± + éªŒè¯ç 
- **åº”å¯¹ç­–ç•¥**ï¼šæ‰¹é‡æ³¨å†Œè´¦å·ï¼Œé€šè¿‡è´¦å·æ± è½®æ¢æ»¡è¶³æ¯æ—¥ç”Ÿäº§éœ€æ±‚

## æ‰¹é‡è´¦å·ç³»ç»Ÿæ¶æ„

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é‚®ç®±ç³»ç»Ÿ           â”‚     â”‚   æŒ‡çº¹æµè§ˆå™¨         â”‚     â”‚   è‡ªåŠ¨åŒ–å¼•æ“         â”‚
â”‚  (Catch-All+IMAP)   â”‚â”€â”€â”€â”€â–¶â”‚  (Playwrightæ³¨å…¥)   â”‚â—€â”€â”€â”€â”€â”‚  (è´¦å·æ± è°ƒåº¦)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚                           â”‚
         â–¼                           â–¼                           â–¼
   APIè·å–éªŒè¯ç               æ¯è´¦å·ç‹¬ç«‹æŒ‡çº¹               æ‰¹é‡æ³¨å†Œ/ç”Ÿæˆè°ƒåº¦

### 1. é‚®ç®±ç³»ç»Ÿï¼šè‡ªå»ºåŸŸå + Cloudflare Catch-All + IMAP

#### 1.1 åŸŸåä¸é‚®ä»¶è·¯ç”±é…ç½®
1. **è´­ä¹°åŸŸå**ï¼ˆå¦‚ `yourvideobot.com`ï¼Œçº¦ $10/å¹´ï¼‰
2. **Cloudflare Email Routing é…ç½®**ï¼š
   - æ·»åŠ åŸŸååˆ° Cloudflare
   - å¯ç”¨ Email Routing â†’ é…ç½® Catch-All è§„åˆ™
   - æ‰€æœ‰ `*@yourvideobot.com` é‚®ä»¶è½¬å‘åˆ°ä¸€ä¸ªä¸»é‚®ç®±ï¼ˆå¦‚ Gmailï¼‰
3. **ç»“æœ**ï¼š`user001@yourvideobot.com`ã€`user002@yourvideobot.com` ç­‰æ— é™é‚®ç®±åœ°å€

#### 1.2 IMAP æ”¶ä»¶è„šæœ¬
```python
# automation/email_receiver.py
import imaplib
import email
import re
import time

class EmailReceiver:
    def __init__(self, imap_server: str, username: str, password: str):
        self.imap_server = imap_server
        self.username = username
        self.password = password
    
    def connect(self):
        self.mail = imaplib.IMAP4_SSL(self.imap_server)
        self.mail.login(self.username, self.password)
        self.mail.select("inbox")
    
    def get_verification_code(self, target_email: str, timeout: int = 120) -> str | None:
        """è·å–å‘é€åˆ°æŒ‡å®šé‚®ç®±åœ°å€çš„éªŒè¯ç """
        start_time = time.time()
        while time.time() - start_time < timeout:
            self.mail.recent()
            status, messages = self.mail.search(None, f'(TO "{target_email}")')
            if status != "OK":
                time.sleep(5)
                continue
            
            msg_ids = messages[0].split()
            if not msg_ids:
                time.sleep(5)
                continue
            
            latest_id = msg_ids[-1]
            status, msg_data = self.mail.fetch(latest_id, "(RFC822)")
            if status != "OK":
                continue
            
            raw_email = msg_data[0][1]
            msg = email.message_from_bytes(raw_email)
            body = self._get_body(msg)
            
            # åŒ¹é…éªŒè¯ç ï¼ˆ4-6ä½æ•°å­—ï¼‰
            code_match = re.search(r'\b(\d{4,6})\b', body)
            if code_match:
                return code_match.group(1)
            
            time.sleep(5)
        return None
    
    def _get_body(self, msg) -> str:
        if msg.is_multipart():
            for part in msg.walk():
                if part.get_content_type() == "text/plain":
                    return part.get_payload(decode=True).decode('utf-8', errors='ignore')
        return msg.get_payload(decode=True).decode('utf-8', errors='ignore')
    
    def close(self):
        self.mail.logout()
```

### 2. æŒ‡çº¹æµè§ˆå™¨ï¼šPlaywright + è‡ªå»ºæŒ‡çº¹æ³¨å…¥

#### 2.1 æŒ‡çº¹ç”Ÿæˆä¸æ³¨å…¥
```python
# automation/fingerprint_browser.py
import random
import hashlib
from pathlib import Path
from playwright.sync_api import sync_playwright

def generate_fingerprint(seed: str) -> dict:
    """æ ¹æ®è´¦å· ID ç”Ÿæˆä¸€è‡´çš„æŒ‡çº¹é…ç½®"""
    random.seed(hashlib.md5(seed.encode()).hexdigest())
    return {
        "userAgent": random.choice([
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/120.0.0.0 Safari/537.36",
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 Chrome/120.0.0.0 Safari/537.36",
        ]),
        "platform": random.choice(["Win32", "MacIntel"]),
        "language": random.choice(["en-US", "zh-CN"]),
        "timezone": random.choice(["America/New_York", "Asia/Shanghai"]),
        "screen": {"width": random.choice([1920, 1680, 1440]), "height": random.choice([1080, 1050, 900])},
        "hardwareConcurrency": random.choice([4, 8, 12]),
        "deviceMemory": random.choice([4, 8, 16]),
        "webgl": {
            "vendor": random.choice(["Google Inc. (NVIDIA)", "Google Inc. (Intel)"]),
            "renderer": random.choice(["ANGLE (NVIDIA GeForce GTX 1080)", "ANGLE (Intel UHD Graphics 630)"]),
        },
        "canvasNoise": random.random() * 0.0001,
    }

INJECT_SCRIPT = """
(fp) => {
    Object.defineProperty(navigator, 'userAgent', { get: () => fp.userAgent });
    Object.defineProperty(navigator, 'platform', { get: () => fp.platform });
    Object.defineProperty(navigator, 'language', { get: () => fp.language });
    Object.defineProperty(navigator, 'hardwareConcurrency', { get: () => fp.hardwareConcurrency });
    Object.defineProperty(navigator, 'deviceMemory', { get: () => fp.deviceMemory });
    Object.defineProperty(navigator, 'webdriver', { get: () => undefined });
    Object.defineProperty(screen, 'width', { get: () => fp.screen.width });
    Object.defineProperty(screen, 'height', { get: () => fp.screen.height });
    // WebGL
    const proxy = { apply: (t, a, args) => args[0]===37445?fp.webgl.vendor:args[0]===37446?fp.webgl.renderer:Reflect.apply(t,a,args) };
    WebGLRenderingContext.prototype.getParameter = new Proxy(WebGLRenderingContext.prototype.getParameter, proxy);
}
"""

class FingerprintBrowser:
    def __init__(self, account_id: str, profiles_dir: str = "./browser_profiles"):
        self.account_id = account_id
        self.profile_dir = Path(profiles_dir) / account_id
        self.profile_dir.mkdir(parents=True, exist_ok=True)
        self.fingerprint = generate_fingerprint(account_id)
    
    def launch(self, headless: bool = False):
        self.playwright = sync_playwright().start()
        self.context = self.playwright.chromium.launch_persistent_context(
            user_data_dir=str(self.profile_dir),
            headless=headless,
            args=['--disable-blink-features=AutomationControlled'],
            user_agent=self.fingerprint["userAgent"],
            viewport={"width": self.fingerprint["screen"]["width"], "height": self.fingerprint["screen"]["height"]},
            locale=self.fingerprint["language"],
            timezone_id=self.fingerprint["timezone"],
        )
        self.context.add_init_script(INJECT_SCRIPT, self.fingerprint)
        page = self.context.pages[0] if self.context.pages else self.context.new_page()
        return self.context, page
    
    def close(self):
        self.context.close()
        self.playwright.stop()
```

### 3. è´¦å·æ± ç®¡ç†
```python
# automation/account_pool.py
import json
from datetime import date
from pathlib import Path
from dataclasses import dataclass, asdict

@dataclass
class Account:
    id: str
    email: str
    password: str
    registered: bool = False
    daily_usage: int = 0
    last_used_date: str = ""
    status: str = "active"

class AccountPool:
    DAILY_LIMIT = 3
    
    def __init__(self, pool_file: str = "./account_pool.json"):
        self.pool_file = Path(pool_file)
        self.accounts: dict[str, Account] = {}
        self._load()
    
    def _load(self):
        if self.pool_file.exists():
            data = json.loads(self.pool_file.read_text())
            self.accounts = {k: Account(**v) for k, v in data.items()}
    
    def _save(self):
        self.pool_file.write_text(json.dumps({k: asdict(v) for k, v in self.accounts.items()}, indent=2))
    
    def get_available_account(self):
        today = date.today().isoformat()
        for acc in self.accounts.values():
            if acc.status != "active" or not acc.registered:
                continue
            if acc.last_used_date != today:
                acc.daily_usage = 0
                acc.last_used_date = today
            if acc.daily_usage < self.DAILY_LIMIT:
                return acc
        return None
    
    def mark_used(self, account_id: str):
        acc = self.accounts.get(account_id)
        if acc:
            acc.daily_usage += 1
            acc.last_used_date = date.today().isoformat()
            self._save()
    
    def get_stats(self):
        today = date.today().isoformat()
        remaining = sum(
            max(0, self.DAILY_LIMIT - a.daily_usage) if a.last_used_date == today else self.DAILY_LIMIT
            for a in self.accounts.values() if a.registered and a.status == "active"
        )
        return {"total": len(self.accounts), "remaining_quota": remaining}
```

### 4. Lovart.ai è‡ªåŠ¨åŒ–æµç¨‹ï¼ˆæ ¸å¿ƒï¼‰

#### 4.1 å…³é”®é€‰æ‹©å™¨

| åŠŸèƒ½ | é€‰æ‹©å™¨ | è¯´æ˜ |
|------|--------|------|
| æ³¨å†ŒæŒ‰é’® | `button:has(span.mantine-Button-label:text("æ³¨å†Œ"))` | é¦–é¡µæ³¨å†Œå…¥å£ |
| é‚®ç®±è¾“å…¥æ¡† | `input[type="email"]` | é‚®ç®±è¾“å…¥ |
| Success æ ‡è¯† | `#success-text` | é‚®ç®±éªŒè¯æˆåŠŸæ ‡è¯† |
| ç»§ç»­æŒ‰é’® | `button:has(span.mantine-Button-label:text("ä½¿ç”¨é‚®ç®±ç»§ç»­"))` | ç‚¹å‡»ç»§ç»­ç™»å½• |
| éªŒè¯ç è¾“å…¥æ¡† | `input[data-testid="undefined-input-0"]` ~ `input[data-testid="undefined-input-5"]` | 6ä½éªŒè¯ç  |
| è§†é¢‘æè¿°è¾“å…¥æ¡† | `div[data-testid="agent-message-input"]` | contenteditable |
| é™„ä»¶ä¸Šä¼ æŒ‰é’® | `button.rounded-full:has(svg path[d^="M16 1.1"])` | å›å½¢é’ˆå›¾æ ‡ï¼Œä¸Šä¼ å›¾ç‰‡ |
| ä¸‹è½½æŒ‰é’® | `button:has(svg path[d*="M7.858 2.023"])` | è§†é¢‘æ’­æ”¾å™¨ä¸Šçš„ä¸‹è½½ |

#### 4.2 è‡ªåŠ¨åŒ–ä»£ç 

```python
# automation/lovart_automation.py
import asyncio
import json
from pathlib import Path
from datetime import datetime
from playwright.async_api import async_playwright, Page, BrowserContext

class LovartAutomation:
    """Lovart.ai è‡ªåŠ¨åŒ–æ ¸å¿ƒç±»ï¼ˆå¼‚æ­¥å®ç°ï¼Œæ”¯æŒåŒå±‚å¹¶è¡Œï¼‰"""
    
    BASE_URL = "https://www.lovart.ai/zh"
    HOME_URL = "https://www.lovart.ai/zh/home"
    PROMPT_PREFIX = ""
    
    def __init__(self, email_receiver, account_pool, config: dict = None):
        self.email_receiver = email_receiver
        self.account_pool = account_pool
        self.config = config or {}
        self.PROMPT_PREFIX = self.config.get("prompt_prefix", "")
    
    async def login_or_register(self, account, page: Page) -> bool:
        """æ³¨å†Œæˆ–ç™»å½•æµç¨‹ï¼ˆå¼‚æ­¥ï¼‰"""
        try:
            await page.goto(self.BASE_URL)
            await page.wait_for_load_state("networkidle")
            await page.click('button:has(span.mantine-Button-label:text("æ³¨å†Œ"))')
            await page.wait_for_timeout(1000)
            
            await page.fill('input[type="email"]', account.email)
            await page.wait_for_timeout(500)
            
            await page.wait_for_selector('#success-text', timeout=30000)
            await page.click('button:has(span.mantine-Button-label:text("ä½¿ç”¨é‚®ç®±ç»§ç»­"))')
            await page.wait_for_timeout(2000)
            
            # å¼‚æ­¥è·å–éªŒè¯ç 
            code = await asyncio.to_thread(
                self.email_receiver.get_verification_code, account.email, 120
            )
            if not code or len(code) != 6:
                print(f"[{account.id}] éªŒè¯ç è·å–å¤±è´¥: {code}")
                return False
            
            for i, digit in enumerate(code):
                await page.fill(f'input[data-testid="undefined-input-{i}"]', digit)
                await page.wait_for_timeout(100)
            
            await page.wait_for_timeout(3000)
            
            if "/home" in page.url or await page.query_selector('div[data-testid="agent-message-input"]'):
                print(f"[{account.id}] ç™»å½•æˆåŠŸ")
                return True
            return False
            
        except Exception as e:
            print(f"[{account.id}] ç™»å½•å¤±è´¥: {e}")
            return False
    
    async def generate_video_single(self, page: Page, image_path: str, prompt: str, task_id: str) -> str | None:
        """å•æ¬¡è§†é¢‘ç”Ÿæˆï¼ˆå¼‚æ­¥ï¼‰"""
        try:
            await page.goto(self.HOME_URL)
            await page.wait_for_load_state("networkidle")
            await page.wait_for_timeout(2000)
            
            timestamp = datetime.now().strftime("%Y%m%d%H%M%S")
            full_prompt = f"{self.PROMPT_PREFIX}{task_id}_{timestamp} {prompt}"
            
            input_div = page.locator('div[data-testid="agent-message-input"]')
            await input_div.click()
            await page.keyboard.type(full_prompt)
            await page.wait_for_timeout(500)
            
            async with page.expect_file_chooser() as fc_info:
                await page.click('button.rounded-full:has(svg path[d^="M16 1.1"])')
            file_chooser = await fc_info.value
            await file_chooser.set_files(image_path)
            await page.wait_for_timeout(2000)
            
            await page.keyboard.press("Enter")
            
            download_btn = 'button:has(svg path[d*="M7.858 2.023"])'
            await page.wait_for_selector(download_btn, timeout=600000)
            
            async with page.expect_download() as download_info:
                await page.click(download_btn)
            download = await download_info.value
            
            video_filename = f"{task_id}_{timestamp}.mp4"
            download_path = Path(self.config.get("output_dir", ".")) / video_filename
            await download.save_as(str(download_path))
            
            print(f"[{task_id}] è§†é¢‘ç”ŸæˆæˆåŠŸ: {download_path}")
            return str(download_path)
            
        except Exception as e:
            print(f"[{task_id}] è§†é¢‘ç”Ÿæˆå¤±è´¥: {e}")
            return None
    
    async def generate_videos_for_shot(
        self, ctx: BrowserContext, image_path: str, prompt: str, shot_id: str, count: int = 3
    ) -> list[str]:
        """
        ä¸ºå•ä¸ªé•œå¤´å¹¶è¡Œç”Ÿæˆå¤šä¸ªè§†é¢‘
        - åœ¨åŒä¸€ä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸­å¼€å¯å¤šä¸ª Tab å¹¶è¡Œæ‰§è¡Œ
        """
        pages = [await ctx.new_page() for _ in range(count)]
        
        # å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ç”Ÿæˆä»»åŠ¡
        tasks = [
            self.generate_video_single(page, image_path, prompt, f"{shot_id}_v{i+1}")
            for i, page in enumerate(pages)
        ]
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        # å…³é—­é¡µé¢
        for page in pages:
            await page.close()
        
        # è¿‡æ»¤æˆåŠŸç»“æœ
        return [r for r in results if isinstance(r, str)]


class AsyncFingerprintBrowser:
    """å¼‚æ­¥æŒ‡çº¹æµè§ˆå™¨ç®¡ç†å™¨"""
    
    def __init__(self, account_id: str, fingerprint: dict = None):
        self.account_id = account_id
        self.fingerprint = fingerprint or self._generate_fingerprint()
        self.playwright = None
        self.browser = None
    
    def _generate_fingerprint(self) -> dict:
        import hashlib
        seed = hashlib.md5(self.account_id.encode()).hexdigest()
        return {
            "userAgent": f"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.{int(seed[:4], 16) % 1000}.0",
            "viewport": {"width": 1920, "height": 1080},
            "locale": "zh-CN",
            "timezone_id": "Asia/Shanghai",
        }
    
    async def launch(self, headless: bool = False) -> BrowserContext:
        self.playwright = await async_playwright().start()
        self.browser = await self.playwright.chromium.launch(headless=headless)
        ctx = await self.browser.new_context(
            user_agent=self.fingerprint["userAgent"],
            viewport=self.fingerprint["viewport"],
            locale=self.fingerprint["locale"],
            timezone_id=self.fingerprint["timezone_id"],
        )
        return ctx
    
    async def close(self):
        if self.browser:
            await self.browser.close()
        if self.playwright:
            await self.playwright.stop()


class VideoGenerationScheduler:
    """
    è§†é¢‘ç”Ÿæˆè°ƒåº¦å™¨ï¼ˆæ”¯æŒåŒå±‚å¹¶è¡Œï¼‰
    - ä»»åŠ¡çº§å¹¶è¡Œï¼šå¤šä¸ªé•œå¤´åŒæ—¶å¤„ç†ï¼ˆæ¯ä¸ªé•œå¤´åˆ†é…ä¸€ä¸ªè´¦å·ï¼‰
    - è§†é¢‘çº§å¹¶è¡Œï¼šæ¯ä¸ªé•œå¤´åŒæ—¶ç”Ÿæˆ 3 ä¸ªè§†é¢‘
    """
    
    def __init__(self, config: dict):
        self.config = config
        self.account_pool = AccountPool(config.get("pool_file", "./account_pool.json"))
        self.email_receiver = EmailReceiver(
            imap_server=config["imap_server"],
            username=config["imap_username"],
            password=config["imap_password"],
        )
    
    async def process_single_shot(self, shot_data: dict) -> dict:
        """
        å¤„ç†å•ä¸ªé•œå¤´ï¼ˆå¼‚æ­¥ï¼‰
        shot_data: { shot_id, image_path, prompt, count }
        è¿”å›: { shot_id, videos: [...], error: None }
        """
        shot_id = shot_data["shot_id"]
        
        # è·å–å¯ç”¨è´¦å·
        account = self.account_pool.get_available_account()
        if not account:
            return {"shot_id": shot_id, "videos": [], "error": "æ— å¯ç”¨è´¦å·"}
        
        automation = LovartAutomation(self.email_receiver, self.account_pool, self.config)
        browser = AsyncFingerprintBrowser(account.id)
        
        try:
            ctx = await browser.launch(headless=self.config.get("headless", False))
            
            # å…ˆç™»å½•ï¼ˆä½¿ç”¨ç¬¬ä¸€ä¸ªé¡µé¢ï¼‰
            login_page = await ctx.new_page()
            if not await automation.login_or_register(account, login_page):
                return {"shot_id": shot_id, "videos": [], "error": "ç™»å½•å¤±è´¥"}
            await login_page.close()
            
            # å¹¶è¡Œç”Ÿæˆè§†é¢‘
            videos = await automation.generate_videos_for_shot(
                ctx=ctx,
                image_path=shot_data["image_path"],
                prompt=shot_data["prompt"],
                shot_id=shot_id,
                count=shot_data.get("count", 3)
            )
            
            # æ ‡è®°è´¦å·ä½¿ç”¨
            self.account_pool.mark_used(account.id)
            
            return {"shot_id": shot_id, "videos": videos, "error": None}
            
        except Exception as e:
            return {"shot_id": shot_id, "videos": [], "error": str(e)}
        finally:
            await browser.close()
    
    async def process_multiple_shots(self, shots: list[dict], max_concurrent: int = 3) -> list[dict]:
        """
        å¹¶è¡Œå¤„ç†å¤šä¸ªé•œå¤´
        - shots: [{ shot_id, image_path, prompt, count }, ...]
        - max_concurrent: æœ€å¤§å¹¶å‘é•œå¤´æ•°ï¼ˆå—é™äºå¯ç”¨è´¦å·æ•°ï¼‰
        """
        self.email_receiver.connect()
        
        try:
            # ä½¿ç”¨ Semaphore æ§åˆ¶å¹¶å‘æ•°
            semaphore = asyncio.Semaphore(max_concurrent)
            
            async def limited_task(shot_data):
                async with semaphore:
                    return await self.process_single_shot(shot_data)
            
            # å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
            tasks = [limited_task(shot) for shot in shots]
            results = await asyncio.gather(*tasks)
            
            return results
            
        finally:
            self.email_receiver.close()
    
    def run(self, shots: list[dict], max_concurrent: int = 3) -> list[dict]:
        """åŒæ­¥å…¥å£ï¼Œä¾›å¤–éƒ¨è°ƒç”¨"""
        return asyncio.run(self.process_multiple_shots(shots, max_concurrent))


# ========== ä½¿ç”¨ç¤ºä¾‹ ==========
if __name__ == "__main__":
    config = {
        "imap_server": "imap.gmail.com",
        "imap_username": "your-inbox@gmail.com",
        "imap_password": "your-app-password",
        "pool_file": "./account_pool.json",
        "output_dir": "./videos/",
        "prompt_prefix": "",
        "headless": False,
    }
    
    # å¤šä¸ªé•œå¤´ä»»åŠ¡
    shots = [
        {"shot_id": "shot_01", "image_path": "/path/to/img1.png", "prompt": "æè¿°1", "count": 3},
        {"shot_id": "shot_02", "image_path": "/path/to/img2.png", "prompt": "æè¿°2", "count": 3},
        {"shot_id": "shot_03", "image_path": "/path/to/img3.png", "prompt": "æè¿°3", "count": 3},
    ]
    
    scheduler = VideoGenerationScheduler(config)
    
    # å¹¶è¡Œå¤„ç†ï¼šæœ€å¤š 3 ä¸ªé•œå¤´åŒæ—¶å¤„ç†ï¼Œæ¯ä¸ªé•œå¤´åŒæ—¶ç”Ÿæˆ 3 ä¸ªè§†é¢‘
    results = scheduler.run(shots, max_concurrent=3)
    
    for r in results:
        print(f"é•œå¤´ {r['shot_id']}: {len(r['videos'])} ä¸ªè§†é¢‘, é”™è¯¯: {r['error']}")
```

#### 4.3 é…ç½®æ–‡ä»¶ç¤ºä¾‹

```json
{
  "imap_server": "imap.gmail.com",
  "imap_username": "your-inbox@gmail.com",
  "imap_password": "your-app-password",
  "pool_file": "./account_pool.json",
  "output_dir": "./workspaces/{id}/generated_xxx/videos/",
  "prompt_prefix": "",
  "headless": false
}
```

> **è¯´æ˜**ï¼š`prompt_prefix` ä¸ºè§†é¢‘æè¿°å‰ç¼€ï¼Œå¯é…ç½®ä¸ºä»»æ„æ–‡å­—ï¼Œç•™ç©ºåˆ™ä¸æ·»åŠ å‰ç¼€ã€‚

### 5. æ‰¹é‡è´¦å·é¢„æ³¨å†Œå·¥å…·

```python
# automation/batch_register.py
import asyncio
from lovart_automation import LovartAutomation, AsyncFingerprintBrowser
from account_pool import AccountPool, Account
from email_receiver import EmailReceiver

async def register_single_account(account: Account, automation: LovartAutomation, headless: bool = False) -> bool:
    """æ³¨å†Œå•ä¸ªè´¦å·"""
    browser = AsyncFingerprintBrowser(account.id)
    try:
        ctx = await browser.launch(headless=headless)
        page = await ctx.new_page()
        success = await automation.login_or_register(account, page)
        if success:
            account.registered = True
            print(f"âœ“ è´¦å· {account.email} æ³¨å†ŒæˆåŠŸ")
        else:
            print(f"âœ— è´¦å· {account.email} æ³¨å†Œå¤±è´¥")
        return success
    except Exception as e:
        print(f"âœ— è´¦å· {account.email} æ³¨å†Œå¼‚å¸¸: {e}")
        return False
    finally:
        await browser.close()

async def batch_register(config: dict, max_concurrent: int = 3):
    """æ‰¹é‡é¢„æ³¨å†Œè´¦å·"""
    pool = AccountPool(config["pool_file"])
    email_receiver = EmailReceiver(
        imap_server=config["imap_server"],
        username=config["imap_username"],
        password=config["imap_password"],
    )
    email_receiver.connect()
    automation = LovartAutomation(email_receiver, pool, config)
    
    unregistered = [acc for acc in pool.accounts.values() if not acc.registered]
    print(f"å¾…æ³¨å†Œè´¦å·æ•°: {len(unregistered)}")
    
    semaphore = asyncio.Semaphore(max_concurrent)
    async def limited_register(account):
        async with semaphore:
            return await register_single_account(account, automation, config.get("headless", False))
    
    tasks = [limited_register(acc) for acc in unregistered]
    results = await asyncio.gather(*tasks)
    pool._save()
    email_receiver.close()
    
    success_count = sum(1 for r in results if r)
    print(f"\næ³¨å†Œå®Œæˆ: {success_count}/{len(unregistered)} æˆåŠŸ")

def generate_accounts(domain: str, count: int, pool_file: str = "./account_pool.json"):
    """ç”Ÿæˆè´¦å·é…ç½®æ–‡ä»¶"""
    import json
    from pathlib import Path
    
    accounts = {}
    for i in range(1, count + 1):
        account_id = f"user{i:03d}"
        accounts[account_id] = {
            "id": account_id,
            "email": f"{account_id}@{domain}",
            "password": "",
            "registered": False,
            "daily_usage": 0,
            "last_used_date": "",
            "status": "active"
        }
    Path(pool_file).write_text(json.dumps(accounts, indent=2, ensure_ascii=False))
    print(f"å·²ç”Ÿæˆ {count} ä¸ªè´¦å·é…ç½®åˆ° {pool_file}")

# ä½¿ç”¨: python batch_register.py generate yourvideobot.com 100
# æˆ–:   python batch_register.py ï¼ˆæ‰§è¡Œæ‰¹é‡æ³¨å†Œï¼‰
```

---

## ä¸ç°æœ‰å›¾ç‰‡ç”Ÿæˆé€»è¾‘çš„å¯¹ç…§å‚è€ƒ

> è§†é¢‘ç”Ÿæˆéœ€å‚è€ƒç°æœ‰å›¾ç‰‡ç”Ÿæˆæ¨¡å¼ï¼Œä¿æŒæ¶æ„ä¸€è‡´æ€§ã€‚

### å‚è€ƒé¡¹å¯¹ç…§è¡¨

| æ¨¡å— | å›¾ç‰‡ç”Ÿæˆï¼ˆç°æœ‰ï¼‰ | è§†é¢‘ç”Ÿæˆï¼ˆæ–°å¢ï¼‰ |
|------|------------------|------------------|
| **åç«¯ API** | `POST /api/image-tasks` | `POST /api/video-tasks` |
| **ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢** | `GET /api/image-tasks/{taskId}` | `GET /api/video-tasks/{taskId}` |
| **ä»»åŠ¡è®°å½•ç›®å½•** | `generated_xxx/image_tasks/` | `generated_xxx/video_tasks/` |
| **äº§ç‰©ç›®å½•** | `generated_xxx/shots/` | `generated_xxx/videos/` |
| **é€‰ä¸­è®°å½•** | `selected_images.json` | å…¨ä¿ç•™ï¼Œæ— éœ€é€‰æ‹© |
| **å‰ç«¯ç»„ä»¶** | `Step3_DeconstructionReview.tsx` | åŒæ–‡ä»¶ï¼Œæ–°å¢è§†é¢‘ç´ ææµ |
| **å¹¶å‘ç”Ÿæˆ** | `asyncio.gather()` å¹¶å‘ N å¼ å›¾ | `asyncio.gather()` å¹¶å‘ 3 ä¸ªè§†é¢‘ |

### å…³é”®å‚è€ƒæ–‡ä»¶

```
backend/main.py
â”œâ”€â”€ POST /api/image-tasks          â†’ å‚è€ƒåˆ›å»ºè§†é¢‘ä»»åŠ¡
â”œâ”€â”€ GET /api/image-tasks/{taskId}  â†’ å‚è€ƒä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
â”œâ”€â”€ run_image_task()               â†’ å‚è€ƒåå°ä»»åŠ¡æ‰§è¡Œ

frontend/components/workflow/Step3_DeconstructionReview.tsx
â”œâ”€â”€ pollTaskStatus()               â†’ å‚è€ƒä»»åŠ¡è½®è¯¢
â”œâ”€â”€ generatedDir                   â†’ å‚è€ƒç›®å½•ç»“æ„

workspaces/{id}/generated_xxx/
â”œâ”€â”€ selected_images.json           â†’ ç»“æ„: { "indexes": { "shot_id": "filename" } }
â”œâ”€â”€ image_tasks/                   â†’ ä»»åŠ¡è®°å½• JSON
```

---

## æ•°æ®è¾“å…¥ä¸å­˜å‚¨

### è¾“å…¥æ•°æ®
- **é¦–å¸§å›¾**ï¼šä» `selected_images.json` è¯»å–ï¼Œæ¯é•œå¤´**ä»… 1 å¼ **é€‰ä¸­å›¾
- **è§†é¢‘æè¿°**ï¼šé•œå¤´çš„ `videoDescription` å­—æ®µ
- **å®Œæ•´æç¤ºè¯**ï¼š`{prompt_prefix}{shot_id}_{timestamp} {videoDescription}`

### è¾“å‡ºå­˜å‚¨

- **è§†é¢‘æ–‡ä»¶**ï¼š`workspaces/{id}/generated_xxx/videos/{shot_id}_{timestamp}_v{1,2,3}.mp4`
- **ä»»åŠ¡è®°å½•**ï¼š`workspaces/{id}/generated_xxx/video_tasks/{taskId}.json`
- **å…¨ä¿ç•™**ï¼Œæ— éœ€é€‰æ‹©é€»è¾‘

---

## å‰ç«¯æ”¹åŠ¨

### é•œå¤´å¡ç‰‡

- è§†é¢‘æè¿°å³ä¾§å¢åŠ  **"ç”Ÿè§†é¢‘"** æŒ‰é’®
- ç‚¹å‡»åè°ƒç”¨ `POST /api/video-tasks`

### é…ç½®å¼¹çª—

- ç°æœ‰"ä¾›åº”å•†"æ”¹ä¸º"ç”Ÿå›¾ä¾›åº”å•†"
- æ–°å¢ **"ç”Ÿè§†é¢‘é…ç½®"** æŒ‰é’®ï¼Œå¯é…ç½®ï¼šheadless/å¯è§ã€ä»»åŠ¡æ•°ã€è¶…æ—¶

### è§†é¢‘ç´ ææµ

- å±•ç¤ºé€»è¾‘å‚è€ƒå›¾ç‰‡ç´ ææµ
- **å…¨ä¿ç•™**ï¼Œä¸éœ€è¦é€‰æ‹©
- ä» `generated_xxx/videos/` åŠ è½½è§†é¢‘å¹¶æ¸²æŸ“

---

## åç«¯ API

### `POST /api/video-tasks`

åˆ›å»ºè§†é¢‘ç”Ÿæˆä»»åŠ¡ï¼ˆå‚è€ƒ `/api/image-tasks`ï¼‰ã€‚

### `GET /api/video-tasks/{taskId}`

æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆå‚è€ƒ `/api/image-tasks/{taskId}`ï¼‰ã€‚

---

## é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `headless` | `false` | æµè§ˆå™¨æ¨¡å¼ |
| `prompt_prefix` | `""` | è§†é¢‘æè¿°å‰ç¼€ï¼ˆå¯é…ç½®ï¼‰ |
| `task_timeout` | `600s` | å•ä»»åŠ¡è¶…æ—¶ |
| `max_concurrent_tasks` | `3` | æœ€å¤§å¹¶å‘ä»»åŠ¡æ•° |

---

## å®‰å…¨ä¸å‡­è¯

- è´¦å·æ± ã€IMAP å‡­è¯**ä¸å…¥ä»“åº“**
- æµè§ˆå™¨ Profile æœ¬åœ°å­˜å‚¨ï¼Œå¤ç”¨ç™»å½•æ€

---

## ç›‘æ§ä¸é”™è¯¯å¤„ç†

- å‰ç«¯æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€å’Œé”™è¯¯æ‘˜è¦
- åç«¯è®°å½•é”™è¯¯æ—¥å¿—å’Œæˆªå›¾
- å¤±è´¥ä»»åŠ¡æ”¯æŒé‡è¯•

---

# é™„å½•ï¼šæ–¹æ¡ˆäºŒ - æµ·èº AIï¼ˆæš‚ä¸å®ç°ï¼‰

> âš ï¸ **çŠ¶æ€ï¼šæš‚ä¸å®ç°**  
> ä»¥ä¸‹å†…å®¹ä¿ç•™ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆå‚è€ƒï¼Œå½“å‰ä¼˜å…ˆä½¿ç”¨ Lovart.ai æ–¹æ¡ˆã€‚

## å¹³å°è¯´æ˜

- **ç›®æ ‡ç½‘å€**ï¼š`https://hailuoai.com/create/image-to-video`
- **æˆ‘çš„ä½œå“**ï¼š`https://hailuoai.com/mine`

## è‡ªåŠ¨åŒ–æ­¥éª¤

1. **å¯åŠ¨æµè§ˆå™¨**
   - å¯é€‰ï¼šheadless/æœ‰å¤´ã€ä»£ç†/VPNã€å¤ç”¨ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆä¿ç™»å½•æ€ï¼‰ã€‚

2. **æ‰“å¼€é¡µé¢** `https://hailuoai.com/create/image-to-video`

3. **ä¸Šä¼ å›¾ç‰‡**
   - å®šä½"æ‹–æ‹½/ç²˜è´´/ç‚¹å‡»ä¸Šä¼ æ–°å›¾ç‰‡"åŒºåŸŸï¼ˆå« SVG ä¸æ–‡å­—ï¼‰ï¼Œä¸Šä¼  `selected_images.json` ä¸­çš„å›¾ç‰‡æ–‡ä»¶ã€‚

4. **å¡«å†™è§†é¢‘æè¿°**
   - å®šä½ `#video-create-textarea`ï¼ˆcontenteditableï¼‰å†™å…¥è§†é¢‘æè¿°ã€‚
   - å‰ç¼€æ ¼å¼ï¼š`{é•œå¤´åºå·}_{YYYYMMDDHHmmss}`ï¼Œç¤ºä¾‹ `01_20251201110836`

5. **è®¾ç½®ç”Ÿæˆæ•°é‡ = 3**
   - æ“ä½œ `ant-input-number` æ§ä»¶ï¼šå¯ç›´æ¥è®¾å€¼ä¸º 3ï¼Œæˆ–ç‚¹å‡»ä¸Šç®­å¤´ä¸¤æ¬¡ã€‚

6. **ç‚¹å‡»ç”Ÿæˆ**
   - ç‚¹å‡»ä¸æ•°é‡æ§ä»¶è”åŠ¨çš„ç”ŸæˆæŒ‰é’®ï¼ˆç²¾ç¡®é€‰æ‹©å™¨éœ€å®æµ‹ç¡®è®¤ï¼‰ã€‚

7. **ç»“æœç›‘æ§ä¸ä¸‹è½½**
   - è¿›å…¥ `https://hailuoai.com/mine`ï¼Œè½®è¯¢ç”Ÿæˆåˆ—è¡¨ã€‚
   - å®šä½å«æœ‰å‰ç¼€ `{é•œå¤´åºå·}_{æ—¶é—´æˆ³}` çš„ `<span class="prompt-plain-span">` æ–‡æœ¬ï¼Œç¡®è®¤ç”Ÿæˆå®Œæˆã€‚
   - åŒ¹é…åˆ°åï¼Œè§¦å‘ä¸‹è½½ï¼ˆç‚¹å‡»ä¸‹è½½/å¯¼å‡ºæŒ‰é’®ï¼›ä¸‹è½½æŒ‰é’®é€‰æ‹©å™¨éœ€å®æµ‹ï¼‰ã€‚
   - ä¿å­˜è§†é¢‘è‡³ `workspaces/{id}/generated_xxx/videos/`ï¼Œæ–‡ä»¶åä¿ç•™å‰ç¼€ã€‚

## å…³é”®é€‰æ‹©å™¨ï¼ˆå¾…å®æµ‹ï¼‰

| å…ƒç´  | é€‰æ‹©å™¨ |
|------|--------|
| è§†é¢‘æè¿°è¾“å…¥æ¡† | `#video-create-textarea` |
| ç”Ÿæˆæ•°é‡æ§ä»¶ | `.ant-input-number` |
| ç”ŸæˆæŒ‰é’® | å¾…å®æµ‹ |
| ä½œå“åˆ—è¡¨é¡¹æ ‡é¢˜ | `span.prompt-plain-span` |
| ä¸‹è½½æŒ‰é’® | å¾…å®æµ‹ |
